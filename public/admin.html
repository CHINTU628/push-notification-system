<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Push Admin</title>

<!-- Tailwind CDN -->
<script src="https://cdn.tailwindcss.com"></script>

</head>

<body class="bg-slate-950 text-white flex justify-center items-center min-h-screen">

<div class="w-full max-w-md p-4">

<!-- PREVIEW CARD -->
<div class="bg-slate-900 rounded-2xl shadow-2xl overflow-hidden mb-6">

<div id="previewImageContainer" class="hidden">
<img id="previewImg" class="w-full h-48 object-cover">
</div>

<div class="p-4 flex gap-3 items-start">
<img id="previewIcon" class="w-10 h-10 rounded-full hidden">
<div>
<h3 id="pTitle" class="font-bold text-lg">Notification Title</h3>
<p id="pBody" class="text-sm text-slate-300">Notification message preview here...</p>
</div>
</div>

</div>

<!-- CONTROL PANEL -->
<div class="bg-slate-800 p-6 rounded-2xl shadow-xl space-y-3">

<h2 class="text-xl font-bold text-center mb-2">Admin Push Center</h2>

<input id="title" placeholder="Notification Title"
class="w-full p-3 rounded-lg bg-slate-700 outline-none"
oninput="updatePreview()">

<input id="body" placeholder="Notification Message"
class="w-full p-3 rounded-lg bg-slate-700 outline-none"
oninput="updatePreview()">

<!-- IMAGE SECTION -->
<div>
<p class="text-sm mb-1 text-slate-400">Big Image</p>

<select id="imageMode" onchange="toggleImageMode()"
class="w-full p-2 mb-2 rounded bg-slate-700">
<option value="upload">Upload Image</option>
<option value="url">Use Image URL</option>
</select>

<input type="file" id="uploadImage" accept="image/*"
class="w-full mb-2">

<input id="imageUrl" placeholder="Paste Image URL"
class="w-full p-3 rounded-lg bg-slate-700 hidden">

<button onclick="handleImage()"
class="w-full bg-blue-600 p-2 rounded-lg">Apply Image</button>
</div>

<!-- ICON SECTION -->
<div>
<p class="text-sm mb-1 text-slate-400">Small Icon</p>

<select id="iconMode" onchange="toggleIconMode()"
class="w-full p-2 mb-2 rounded bg-slate-700">
<option value="upload">Upload Icon</option>
<option value="url">Use Icon URL</option>
</select>

<input type="file" id="uploadIcon" accept="image/*"
class="w-full mb-2">

<input id="iconUrl" placeholder="Paste Icon URL"
class="w-full p-3 rounded-lg bg-slate-700 hidden">

<button onclick="handleIcon()"
class="w-full bg-purple-600 p-2 rounded-lg">Apply Icon</button>
</div>

<button onclick="send()"
class="w-full bg-green-600 p-3 rounded-xl font-semibold">
Send Notification
</button>

<p id="done" class="text-green-400 text-center mt-2"></p>

</div>
</div>

<script>
const CLOUD_NAME = "dimnhchh8";
const UPLOAD_PRESET = "push_images";

let uploadedImageURL = "";
let uploadedIconURL = "";

/* PREVIEW UPDATE */
function updatePreview(){
  pTitle.innerText = title.value || "Notification Title";
  pBody.innerText = body.value || "Notification message preview here...";
}

/* IMAGE MODE */
function toggleImageMode(){
  if(imageMode.value==="upload"){
    uploadImage.classList.remove("hidden");
    imageUrl.classList.add("hidden");
  }else{
    uploadImage.classList.add("hidden");
    imageUrl.classList.remove("hidden");
  }
}

/* ICON MODE */
function toggleIconMode(){
  if(iconMode.value==="upload"){
    uploadIcon.classList.remove("hidden");
    iconUrl.classList.add("hidden");
  }else{
    uploadIcon.classList.add("hidden");
    iconUrl.classList.remove("hidden");
  }
}

/* UPLOAD TO CLOUDINARY */
async function uploadToCloudinary(file){
  const form = new FormData();
  form.append("file", file);
  form.append("upload_preset", UPLOAD_PRESET);

  const res = await fetch(
    `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`,
    { method:"POST", body:form }
  );

  const data = await res.json();
  return data.secure_url;
}

/* HANDLE IMAGE */
async function handleImage(){
  if(imageMode.value==="url"){
    uploadedImageURL = imageUrl.value;
  }else{
    const file = uploadImage.files[0];
    if(!file) return alert("Select image first");
    uploadedImageURL = await uploadToCloudinary(file);
  }

  previewImg.src = uploadedImageURL;
  previewImageContainer.classList.remove("hidden");
}

/* HANDLE ICON */
async function handleIcon(){
  if(iconMode.value==="url"){
    uploadedIconURL = iconUrl.value;
  }else{
    const file = uploadIcon.files[0];
    if(!file) return alert("Select icon first");
    uploadedIconURL = await uploadToCloudinary(file);
  }

  previewIcon.src = uploadedIconURL;
  previewIcon.classList.remove("hidden");
}

/* SEND PUSH */
async function send(){
  await fetch("https://push-notification-system-chof.onrender.com/send",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      title:title.value,
      body:body.value,
      image:uploadedImageURL,
      icon:uploadedIconURL
    })
  });

  done.innerText="Sent Successfully âœ”";
}
</script>

</body>
</html>
